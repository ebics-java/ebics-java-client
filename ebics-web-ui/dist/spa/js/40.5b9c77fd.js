(self["webpackChunkebics_client_qs"]=self["webpackChunkebics_client_qs"]||[]).push([[40],{1169:(e,t,s)=>{"use strict";s.d(t,{e7:()=>a,Cx:()=>r,UL:()=>n,_3:()=>o});class a{constructor(e="",t="",s="",a="",n=new r){this.serviceName=e,this.serviceOption=t,this.scope=s,this.containerType=a,this.message=n}label(){return`${this.serviceName}|${this.serviceOption}|${this.scope}|${this.containerType}|${this.message.label()}`}}class r{constructor(e="",t="",s="",a=""){this.messageName=e,this.messageNameFormat=a,this.messageNameVariant=t,this.messageNameVersion=s}label(){return`${this.messageName}.${this.messageNameVariant}.${this.messageNameVersion}.${this.messageNameFormat}`}}var n,o;(function(e){e["INI"]="INI",e["HIA"]="HIA",e["HPB"]="HPB",e["SPR"]="SPR"})(n||(n={})),function(e){e[e["CreateUserKeys"]=1]="CreateUserKeys",e[e["UploadUserKeys"]=2]="UploadUserKeys",e[e["PrintUserLetters"]=3]="PrintUserLetters",e[e["DownloadBankKeys"]=4]="DownloadBankKeys",e[e["VerifyBankKeys"]=5]="VerifyBankKeys",e[e["Finish"]=6]="Finish",e[e["Unknown"]=7]="Unknown"}(o||(o={}))},4040:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>J});var a=s(3673),r=s(2323);const n={class:"q-pa-md"},o={key:0},i={key:1},l={class:"q-pa-md",style:{"max-width":"400px"}},u={class:"q-gutter-sm"};function d(e,t,s,d,c,p){const m=(0,a.up)("q-input"),y=(0,a.up)("q-select"),h=(0,a.up)("q-radio"),f=(0,a.up)("q-toggle"),b=(0,a.up)("q-checkbox"),v=(0,a.up)("user-ini-wizz"),g=(0,a.up)("q-btn"),U=(0,a.up)("q-form"),w=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(w,{class:"justify-evenly"},{default:(0,a.w5)((()=>[(0,a.Wm)("div",n,[void 0!==e.id?((0,a.wg)(),(0,a.j4)("h5",o,"Edit existing user "+(0,r.zw)(e.id),1)):((0,a.wg)(),(0,a.j4)("h5",i,"Add new user")),(0,a.Wm)("div",l,[(0,a.Wm)(U,{onSubmit:t[13]||(t[13]=t=>e.onSubmit()),onReset:e.onCancel,class:"q-gutter-md"},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{filled:"",modelValue:e.user.name,"onUpdate:modelValue":t[1]||(t[1]=t=>e.user.name=t),label:"User name",hint:"Customer user name (used for displaying)","lazy-rules":"",rules:[e=>e&&e.length>1||"User name must be at least 2 characters"]},null,8,["modelValue","rules"]),(0,a.Wm)(m,{filled:"",modelValue:e.user.dn,"onUpdate:modelValue":t[2]||(t[2]=t=>e.user.dn=t),label:"User DN",hint:"User domain name for certificat, example: cn=name,c=de,o=Organization,e=myemail@at.com","lazy-rules":"",rules:[e=>e&&e.length>1||"Please enter valid DN at least 2 characters"]},null,8,["modelValue","rules"]),(0,a.Wm)(y,{filled:"",modelValue:e.user.partner.bank,"onUpdate:modelValue":t[3]||(t[3]=t=>e.user.partner.bank=t),options:e.banks,"option-label":"name",hint:"EBICS Bank","lazy-rules":"",rules:[e=>0!=e.id||"Please select valid EBICS Bank"]},null,8,["modelValue","options","rules"]),(0,a.Wm)(m,{filled:"",modelValue:e.user.userId,"onUpdate:modelValue":t[4]||(t[4]=t=>e.user.userId=t),label:"EBICS User ID",hint:"EBICS User ID, example CHT00034","lazy-rules":"",rules:[e=>e&&e.length>0||"Please enter valid EBICS User ID, at least 1 character"]},null,8,["modelValue","rules"]),(0,a.Wm)(m,{filled:"",modelValue:e.user.partner.partnerId,"onUpdate:modelValue":t[5]||(t[5]=t=>e.user.partner.partnerId=t),label:"EBICS Partner ID",hint:"EBICS Partner ID, example CH100208","lazy-rules":"",rules:[e=>e&&e.length>0||"Please enter valid EBICS Customer ID, at least 1 character"]},null,8,["modelValue","rules"]),(0,a.Wm)("div",u,[(0,a.Wm)(h,{modelValue:e.user.ebicsVersion,"onUpdate:modelValue":t[6]||(t[6]=t=>e.user.ebicsVersion=t),disable:e.userStatusInitializing,val:"H003",contextmenu:"test",label:"EBICS 2.4 (H003)"},null,8,["modelValue","disable"]),(0,a.Wm)(h,{modelValue:e.user.ebicsVersion,"onUpdate:modelValue":t[7]||(t[7]=t=>e.user.ebicsVersion=t),disable:e.userStatusInitializing,val:"H004",label:"EBICS 2.5 (H004)"},null,8,["modelValue","disable"]),(0,a.Wm)(h,{modelValue:e.user.ebicsVersion,"onUpdate:modelValue":t[8]||(t[8]=t=>e.user.ebicsVersion=t),onClick:t[9]||(t[9]=t=>e.updateUseCertificate()),disable:e.userStatusInitializing,val:"H005",label:"EBICS 3.0 (H005)"},null,8,["modelValue","disable"])]),(0,a.Wm)(f,{disable:"H005"==e.user.ebicsVersion,modelValue:e.user.useCertificate,"onUpdate:modelValue":t[10]||(t[10]=t=>e.user.useCertificate=t),label:"Use Certificates"},null,8,["disable","modelValue"]),(0,a.Wm)(b,{modelValue:e.user.usePassword,"onUpdate:modelValue":t[11]||(t[11]=t=>e.user.usePassword=t),label:"Protect your private keys with password (2FA)"},null,8,["modelValue"]),(0,a.Wm)(m,{filled:"",modelValue:e.user.userStatus,"onUpdate:modelValue":t[12]||(t[12]=t=>e.user.userStatus=t),label:"EBICS user status"},null,8,["modelValue"]),void 0!==e.user.id?((0,a.wg)(),(0,a.j4)(v,{key:0,id:e.user.id},null,8,["id"])):(0,a.ry)("",!0),(0,a.Wm)("div",null,[void 0===e.id?((0,a.wg)(),(0,a.j4)(g,{key:0,label:"Add",type:"submit",color:"primary"})):((0,a.wg)(),(0,a.j4)(g,{key:1,label:"Update",type:"submit",color:"primary"})),(0,a.Wm)(g,{label:"Cancel",type:"reset",color:"primary",flat:"",class:"q-ml-sm",icon:"undo"})])])),_:1},8,["onReset"])])])])),_:1})}const c=(0,a.Uk)(" Continue in order to create user private public keys. You can optionally set PIN to protect access to your private keys. "),p=(0,a.Uk)(" Continue in order to create user keys and send them to the bank using the entered EBICS parameters (bank url, user, customer). For sending of the keys INI and HIA administrative ordertypes will be used. "),m=(0,a.Uk)(" In order to activate the this EBICS user you have to provide bellow generated hash keys to your bank. The bank will check provided hash keys and activate the EBICS user. Letter A005: XB CX 56 Letter E002: XB CX 56 "),y=(0,a.Uk)(" Continue in order to download bank keys from your bank. "),h=(0,a.Uk)(" Verify bellow downloaded bank keys with the one provided by your bank during onboarding. In case they not match, this connection can't be trussted - identity of the bank is not valid. "),f=(0,a.Uk)(" Do you want to reset the user status? ");function b(e,t,s,r,n,o){const i=(0,a.up)("q-checkbox"),l=(0,a.up)("q-btn"),u=(0,a.up)("q-stepper-navigation"),d=(0,a.up)("q-step"),b=(0,a.up)("q-stepper"),v=(0,a.up)("q-space"),g=(0,a.up)("q-banner"),U=(0,a.up)("q-card-section"),w=(0,a.up)("q-card");return(0,a.wg)(),(0,a.j4)("div",null,[(0,a.Wm)(b,{modelValue:e.actualWizardStep,"onUpdate:modelValue":t[8]||(t[8]=t=>e.actualWizardStep=t),color:"primary",ref:"wizz",animated:"",vertical:""},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{name:e.UserIniWizzStep.CreateUserKeys,title:"Create user keys",icon:"forward_to_inbox",done:e.isStepDone(e.UserIniWizzStep.CreateUserKeys)},{default:(0,a.w5)((()=>[c,(0,a.Wm)(i,{modelValue:e.user.usePassword,"onUpdate:modelValue":t[1]||(t[1]=t=>e.user.usePassword=t),label:"Protect your private keys with password (2FA)"},null,8,["modelValue"]),(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(l,{onClick:t[2]||(t[2]=t=>e.createUserKeys()),color:"primary",label:"Continue"})])),_:1})])),_:1},8,["name","done"]),(0,a.Wm)(d,{name:e.UserIniWizzStep.UploadUserKeys,title:"Upload user keys to bank",icon:"forward_to_inbox",done:e.isStepDone(e.UserIniWizzStep.UploadUserKeys)},{default:(0,a.w5)((()=>[p,(0,a.Wm)(i,{modelValue:e.user.usePassword,"onUpdate:modelValue":t[3]||(t[3]=t=>e.user.usePassword=t),label:"Protect your private keys with password (2FA)"},null,8,["modelValue"]),(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(l,{onClick:t[4]||(t[4]=t=>e.uploadUserKeys()),color:"primary",label:"Continue"})])),_:1})])),_:1},8,["name","done"]),(0,a.Wm)(d,{name:e.UserIniWizzStep.PrintUserLetters,title:"Signing of user letters",caption:"Optional",icon:"email",done:e.isStepDone(e.UserIniWizzStep.PrintUserLetters)},{default:(0,a.w5)((()=>[m,(0,a.Wm)(l,{label:"Print Letters",color:"primary",class:"q-ml-sm",icon:"print"}),(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(l,{onClick:t[5]||(t[5]=t=>e.printUserLetters()),color:"primary",label:"Continue"})])),_:1})])),_:1},8,["name","done"]),(0,a.Wm)(d,{name:e.UserIniWizzStep.DownloadBankKeys,title:"Download bank keys",icon:"download",done:e.isStepDone(e.UserIniWizzStep.DownloadBankKeys)},{default:(0,a.w5)((()=>[y,(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(l,{onClick:t[6]||(t[6]=t=>e.downloadBankKeys()),color:"primary",label:"Continue"})])),_:1})])),_:1},8,["name","done"]),(0,a.Wm)(d,{name:e.UserIniWizzStep.VerifyBankKeys,title:"Verify bank keys",icon:"gpp_good",done:e.isStepDone(e.UserIniWizzStep.VerifyBankKeys)},{default:(0,a.w5)((()=>[h,(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(l,{onClick:t[7]||(t[7]=t=>e.verifyBankKeys()),color:"primary",label:"Finish"})])),_:1})])),_:1},8,["name","done"])])),_:1},8,["modelValue"]),(0,a.Wm)(v),(0,a.Wm)(w,{class:"my-card"},{default:(0,a.w5)((()=>[(0,a.Wm)(U,null,{default:(0,a.w5)((()=>[(0,a.Wm)(g,{"inline-actions":"",class:"text-white bg-red"},{action:(0,a.w5)((()=>[(0,a.Wm)(l,{onClick:t[9]||(t[9]=t=>e.resetUserStatus()),flat:"",color:"white",label:"Reset"})])),default:(0,a.w5)((()=>[f])),_:1})])),_:1})])),_:1})])}var v=s(1169),g=s(1959),U=s(9582),w=s(8825),I=s(1768);function k(e){const t=(0,w.Z)(),s=(0,U.tv)(),r=(0,g.iH)({name:"",userId:"",partner:{partnerId:"",bank:{id:0,name:""}},ebicsVersion:"H005",userStatus:"CREATED"}),n=()=>{void 0!==e&&I.api.get(`/users/${e}`).then((e=>{console.log("User data refreshed"),r.value=e.data})).catch((e=>{t.notify({color:"negative",position:"bottom-right",message:`Loading failed: ${e.message}`,icon:"report_problem"})}))},o=(0,a.Fl)((()=>({ebicsVersion:r.value.ebicsVersion,userId:r.value.userId,name:r.value.name,dn:r.value.dn,partnerId:r.value.partner.partnerId,bankId:r.value.partner.bank.id,useCertificate:r.value.useCertificate,usePassword:r.value.usePassword}))),i=()=>{void 0===e?I.api.post("/users",o.value).then((()=>{t.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"User created successfully"}),s.go(-1)})).catch((e=>{t.notify({color:"negative",position:"bottom-right",message:`Creating of user failed: ${e.message}`,icon:"report_problem"})})):I.api.put(`/users/${e}`,o.value).then((()=>{t.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"User updated sucessfully"}),s.go(-1)})).catch((e=>{t.notify({color:"negative",position:"bottom-right",message:`User update failed: ${e.message}`,icon:"report_problem"})}))};return(0,a.bv)(n),{user:r,userPartnerBank:o,refreshUserData:n,createOrUpdateUserData:i}}var C=function(e,t,s,a){function r(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,n){function o(e){try{l(a.next(e))}catch(t){n(t)}}function i(e){try{l(a["throw"](e))}catch(t){n(t)}}function l(e){e.done?s(e.value):r(e.value).then(o,i)}l((a=a.apply(e,t||[])).next())}))};function S(e){return void 0!==e.isAxiosError}function V(e,t){const s=(0,w.Z)(),r=e=>{s.notify({color:"positive",position:"bottom-right",message:e,icon:"gpp_good"})},n=(e,a)=>{var r;if(console.log(JSON.stringify(a)),S(a))if(null!==a.response){const n=null===(r=a.response)||void 0===r?void 0:r.data;n.message.includes("wrong password")&&(t.value=void 0);let o=n.message;n.description.includes(o)||(o=`message: ${o} description: ${n.description}`),s.notify({color:"negative",position:"bottom-right",message:`${e} '${o}'`,closeBtn:!0,icon:"report_problem",timeout:1e4})}else a.request?s.notify({color:"negative",position:"bottom-right",message:`${e} '${JSON.stringify(a.request)}'`,icon:"report_problem"}):s.notify({color:"negative",position:"bottom-right",message:`${e} '${JSON.stringify(a.message)}'`,icon:"report_problem"});else s.notify({color:"negative",position:"bottom-right",message:`${e} '${JSON.stringify(a)}'`,icon:"report_problem"})},o=(0,g.iH)(!1),i=(0,g.iH)(!1),l=(0,a.Fl)({get(){switch(e.value.userStatus){case"CREATED":return v._3.CreateUserKeys;case"NEW":case"LOCKED":case"PARTLY_INITIALIZED_INI":case"PARTLY_INITIALIZED_HIA":return v._3.UploadUserKeys;case"INITIALIZED":return o.value?v._3.DownloadBankKeys:v._3.PrintUserLetters;case"READY":return i.value?v._3.Finish:v._3.VerifyBankKeys}return v._3.CreateUserKeys},set(t){switch(t){case v._3.DownloadBankKeys:"INITIALIZED"==e.value.userStatus&&(o.value=!0);case v._3.Finish:"READY"==e.value.userStatus&&(i.value=!0)}}}),u=e=>e<l.value,d=t=>C(this,void 0,void 0,(function*(){try{yield I.api.post(`/users/${e.value.id}/certificates`,{password:t}),r(`Certificates created successfully for user name: ${e.value.name} dn: ${e.value.dn}`)}catch(s){n("Create certificates failed: ",s)}})),c=()=>C(this,void 0,void 0,(function*(){try{yield I.api.post(`/users/${e.value.id}/resetStatus`),r(`Initialization status resetted successfully for user name: ${e.value.name}`)}catch(t){n("Initialization status reset failed: ",t)}})),p=(t,s)=>C(this,void 0,void 0,(function*(){if("PARTLY_INITIALIZED_INI"!=e.value.userStatus)try{yield I.api.post(`/users/${e.value.id}/${e.value.ebicsVersion}/send${t}`,{password:s}),r(`${t} executed successfully for user name: ${e.value.name}`)}catch(a){n(`${t} failed: `,a)}}));return{actualWizardStep:l,isStepDone:u,createUserKeysRequest:d,ebicsAdminTypeRequest:p,resetUserStatusRequest:c}}function W(e){const t=(0,w.Z)(),s=(0,g.iH)(void 0),a=e=>new Promise(((a,r)=>{t.dialog({title:e?"Create new password":"Enter password",message:e?"Create new password for your user certificate":"Enter password for your user certificate",prompt:{model:"",type:"password"},cancel:!0,persistent:!0}).onOk((e=>{s.value=e,console.log(`Entered password: ${s.value}`),a(s.value)})).onCancel((()=>{r("Password entry canceled")})).onDismiss((()=>{r("Password entry dismissed")}))})),r=t=>new Promise((r=>{e.value.usePassword?void 0!==s.value?(console.log(`Temp pass used ${s.value}`),r(s.value)):r(a(t)):(console.log("No pass required"),r(""))}));return{tempPassword:s,promptCertPassword:r}}var _=function(e,t,s,a){function r(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,n){function o(e){try{l(a.next(e))}catch(t){n(t)}}function i(e){try{l(a["throw"](e))}catch(t){n(t)}}function l(e){e.done?s(e.value):r(e.value).then(o,i)}l((a=a.apply(e,t||[])).next())}))};const z=(0,a.aZ)({name:"UserInitalizationWizard",props:{id:{type:Number,required:!0}},data(){return{UserIniWizzStep:v._3}},methods:{nextStep(){this.$refs.wizz.next()},resetUserStatus(){return _(this,void 0,void 0,(function*(){try{yield this.resetUserStatusRequest(),this.refreshUserData()}catch(e){console.log(e)}}))},createUserKeys(){return _(this,void 0,void 0,(function*(){try{const e=yield this.promptCertPassword(!0);yield this.createUserKeysRequest(e),this.refreshUserData()}catch(e){console.log(e)}}))},uploadUserKeys(){return _(this,void 0,void 0,(function*(){try{const e=yield this.promptCertPassword(!1);yield this.ebicsAdminTypeRequest(v.UL.INI,e),yield this.ebicsAdminTypeRequest(v.UL.HIA,e),this.refreshUserData()}catch(e){console.log(e)}}))},printUserLetters(){this.nextStep()},downloadBankKeys(){return _(this,void 0,void 0,(function*(){try{const e=yield this.promptCertPassword(!1);yield this.ebicsAdminTypeRequest(v.UL.HPB,e),this.refreshUserData()}catch(e){console.log(e)}}))},verifyBankKeys(){this.nextStep()}},setup(e){const{user:t,refreshUserData:s}=k(e.id),{tempPassword:a,promptCertPassword:r}=W(t),{actualWizardStep:n,isStepDone:o,createUserKeysRequest:i,ebicsAdminTypeRequest:l,resetUserStatusRequest:u}=V(t,a);return{user:t,refreshUserData:s,actualWizardStep:n,isStepDone:o,createUserKeysRequest:i,ebicsAdminTypeRequest:l,resetUserStatusRequest:u,tempPassword:a,promptCertPassword:r}}});var P=s(3518),D=s(4340),q=s(5735),B=s(118),$=s(8240),E=s(2025),K=s(151),N=s(5589),A=s(5607),R=s(7518),Z=s.n(R);z.render=b;const x=z;function L(){const e=(0,w.Z)(),t=(0,g.iH)([]),s=()=>{I.api.get("/banks").then((e=>{t.value=e.data})).catch((t=>{e.notify({color:"negative",position:"bottom-right",message:`Loading failed: ${t.message}`,icon:"report_problem"})}))};return(0,a.bv)(s),{banks:t,refreshBanksData:s}}Z()(z,"components",{QStepper:P.Z,QStep:D.Z,QCheckbox:q.Z,QStepperNavigation:B.Z,QBtn:$.Z,QSpace:E.Z,QCard:K.Z,QCardSection:N.Z,QBanner:A.Z});const H=(0,a.aZ)({name:"User",components:{UserIniWizz:x},props:{id:{type:Number,required:!1,default:void 0}},data(){return{}},computed:{userStatusInitializing(){return"CREATED"!=this.user.userStatus&&"NEW"!=this.user.userStatus}},methods:{onSubmit(){this.createOrUpdateUserData()},onCancel(){this.$router.go(-1)},updateUseCertificate(){console.log("test11"),"H005"==this.user.ebicsVersion&&(this.user.useCertificate=!0)}},setup(e){const{user:t,createOrUpdateUserData:s}=k(e.id),{banks:a}=L();return{banks:a,user:t,createOrUpdateUserData:s}}});var T=s(4379),Q=s(5269),F=s(4689),O=s(9098),j=s(7991),Y=s(8886);H.render=d;const J=H;Z()(H,"components",{QPage:T.Z,QForm:Q.Z,QInput:F.Z,QSelect:O.Z,QRadio:j.Z,QToggle:Y.Z,QCheckbox:q.Z,QBtn:$.Z})}}]);